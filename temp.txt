<!DOCTYPE html>
<html lang="en">
  <style>


/* CSS for dividing the page into two boxes */
.container {
        display: flex;
        justify-content: space-between;
        align-items: stretch;
        width: 100%;
        height: 100vh;
        box-sizing: border-box;
    }

    .box {
        width: 95%; /* Each box takes 50% of the width */
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        border: 1px solid #ccc;
        padding: 10px;
    }

    .left,
    .right {
        width: 95%; /* Each box takes 50% of the width */
        border: 1px solid #ccc;
        margin-right: 10px;
        overflow: auto; /* Add scrollbars if content overflows */
    }




       /* Side box for Create Quiz */
       .side-box {
            width: 300px; /* Set the width of the side box */
            height: 100vh;
            box-sizing: border-box;
            padding: 20px;
            border: 1px solid #ccc;
            float: right; /* Float the side box to the right */
        }

        /* Responsive styles */
        @media (max-width: 768px) {
            .side-box {
                width: 100%; /* Set the side box to take up full width on smaller screens */
                float: none; /* Remove floating */
            }
        }

        /* Quiz Title Form */
        #quizTitle {
            margin-bottom: 10px;
        }

</style>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Create a Quiz</title>
    <link rel="stylesheet" href="navbar.css">
    <link rel="stylesheet" href="general.css">
    <link rel="stylesheet" href="cards.css">
    
  </head>
  <body>
    <!-- Side box for Create Quiz -->
    
    <ul class="topnav">
      <li><a  href="index.html">Home</a></li>
      <li><a href="add-question.html">Add questions</a></li>
      <li><a class= "active" href="make-a-quiz.html">Create a quiz</a></li>
      <li><a href="take-a-quiz.html">Take a quiz</a></li>
      <li class="right"><a href="#about">About</a></li>
    </ul>

    <div class="container">
      <!-- First box -->
      <div class="box">
          <div class="left">
              <!-- Display the cards in the quiz box -->
              <div id="quizContainer" class="quiz-container"></div>
          </div>
          <div class="right">
              <!-- Add any content for the right side here -->
              <div id="list" class="cards"></div>
          </div>
      </div>
      
      <!-- Second box -->
      <div class="box">
          <div class="left">
              <!-- Add content for creating a quiz -->
              <h2>Create a Quiz</h2>
              <!-- Add your form or content for creating a quiz here -->
              <form id="createQuizForm">
                  
                <input type="text" name="quizTitle" id="quizTitle" placeholder="Quiz Title">
                <button type="submit" onclick="saveQuiz()">Save Quiz</button>
                <button type="button" onclick="startNew()">Create New</button>

              </form>
          </div>
          <div class="right">
              <!-- Add any content for the right side here -->
          </div>
      </div>
  </div>
  
    
    

    <script>
      let host = "http://localhost:8080";
    let questions = [];
    displayTheQuestions();

    async function getAll() {
        let response = await fetch(host + "/questions");
        let result = await response.json();
        return result;
    }

    async function displayTheQuestions() {
    if (questions.length == 0) {
        questions = await getAll();
    }

    for (let question of questions) {
        let list = document.createElement("div");
        list.className = "card";
        let innerHtml = `
            <img src="${host}/questions/${question.id}/image" alt="question" style="width:100%">
            <div class="container">
                <h4><b>${question.id}</b></h4> 
                <p>${question.description}</p>
                <form>
                    <input type="radio" id="q${question.id}ptionA" name="q2Answer" value="A">
                    <label for="q${question.id}ptionA">${question.choices[0]}</label><br>

                    <input type="radio" id="q${question.id}ptionB" name="q2Answer" value="B">
                    <label for="q${question.id}ptionB">${question.choices[1]}</label><br>

                    <input type="radio" id="q${question.id}ptionC" name="q2Answer" value="C">
                    <label for="q${question.id}ptionC">${question.choices[2]}</label><br>       
                </form> 
            </div>
        `;
        list.innerHTML = innerHtml;
        // Add event listener to each card element
        list.addEventListener('click', function() {
            addCardToQuiz(question);
        });
        document.getElementById("list").appendChild(list);
    }
}

// Function to add a selected card to the create quiz box
function addCardToQuiz(question) {
    let createQuizBox = document.querySelector('.box:nth-child(2) .left');
    let cardHtml = `
        <div class="card">
            <img src="${host}/questions/${question.id}/image" alt="question" style="width:100%">
            <div class="container">
                <h4><b>${question.id}</b></h4> 
                <p>${question.description}</p>
                <form>
                    <input type="radio" id="q${question.id}ptionA" name="q2Answer" value="A">
                    <label for="q${question.id}ptionA">${question.choices[0]}</label><br>

                    <input type="radio" id="q${question.id}ptionB" name="q2Answer" value="B">
                    <label for="q${question.id}ptionB">${question.choices[1]}</label><br>

                    <input type="radio" id="q${question.id}ptionC" name="q2Answer" value="C">
                    <label for="q${question.id}ptionC">${question.choices[2]}</label><br>       
                </form> 
            </div>
        </div>
    `;
    createQuizBox.insertAdjacentHTML('beforeend', cardHtml);
}


// Function to handle the saving of the quiz
async function saveQuiz() {
    let title = document.getElementById("quizTitle").value;
    let selectedQuestions = getSelectedQuestions();
    
    if (title && selectedQuestions.length > 0) {
        let quizData = {
            title: title,
            questionIds: selectedQuestions
        };
        let response = await fetch(host + "/quizzes", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(quizData),
        });

        if (response.ok) {
            alert("Quiz saved successfully!");
            // Reset the form or perform any other action after saving the quiz
        } else {
            alert("Failed to save the quiz.");
        }
    } else {
        alert("Please enter a title and select at least one question.");
    }
}

// Function to get the IDs of selected questions
function getSelectedQuestions() {
    let selectedQuestions = [];
    let cards = document.querySelectorAll('.box:nth-child(1) .card');
    cards.forEach(card => {
        let questionId = card.querySelector('h4').innerText;
        selectedQuestions.push(parseInt(questionId));
    });
    return selectedQuestions;
}

// Event listener to handle clicking on cards in the quiz box
document.querySelectorAll('.box:nth-child(1) .card').forEach(card => {
    card.addEventListener('click', function() {
        let question = {
            id: this.querySelector('h4').innerText,
            description: this.querySelector('p').innerText,
            choices: Array.from(this.querySelectorAll('label')).map(label => label.innerText),
        };
        addCardToQuiz(question);
    });
});


function startNew() {
    saveChanges(); // Save the changes first
    
    
}


    </script>
  </body>
</html>
