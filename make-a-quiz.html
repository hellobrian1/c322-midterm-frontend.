<!DOCTYPE html>
<html lang="en">
  <style>
     /* CSS styles for the two viewports */
    /* CSS styles for the two viewports */
    .viewport {
            width: calc(100% - 420px); /* Adjust the width to consider the total width of the side box */
            height: 100vh;
            box-sizing: border-box;
            padding: 20px;
            border: 1px solid #ccc;
            float: left; /* Float the viewport to the left */
        }

        /* Style for the side box */
        .side-box {
            width: 300px; /* Set the width of the side box */
            height: 100vh;
            box-sizing: border-box;
            padding: 20px;
            border: 1px solid #ccc;
            float: right; /* Float the side box to the right */
        }

        /* Responsive styles */
        @media (max-width: 768px) {
            .viewport, .side-box {
                width: 100%; /* Set both viewports to take up full width on smaller screens */
                float: none; /* Remove floating */
            }
        }

    .viewport:nth-child(1) {
        width: calc(59% - 2px); /* Adjust width of the first viewport */
    }

    .viewport .list {
        display: flex;
        flex-wrap: wrap; /* Allow cards to wrap to the next line */
        justify-content: space-between; /* Distribute cards evenly */
    }

    .viewport .card {
        width: 50%; /* Adjust the width to make the card smaller */
        margin-bottom: 20px; /* Add margin for spacing between cards */
    }
</style>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Create a Quiz</title>
    <link rel="stylesheet" href="navbar.css">
    <link rel="stylesheet" href="general.css">
    <link rel="stylesheet" href="cards.css">
    
  </head>
  <body>
    <!-- Side box for Create Quiz -->
    <div class="side-box">
      <h2>Create Quiz</h2>
      <!-- Add your functionality components here -->
      <form>
          <label for="quizTitle">Quiz Title:</label><br>
          <input type="text" id="quizTitle" name="quizTitle"><br><br>
          <button type="button" onclick="saveChanges()">Save Your Changes</button>
          <button type="button" onclick="startNew()">Start New One</button>
      </form>
  </div>
    <ul class="topnav">
      <li><a  href="index.html">Home</a></li>
      <li><a href="add-question.html">Add questions</a></li>
      <li><a class= "active" href="make-a-quiz.html">Create a quiz</a></li>
      <li><a href="take-a-quiz.html">Take a quiz</a></li>
      <li class="right"><a href="#about">About</a></li>
    </ul>

    <form>
      <!-- Question Text -->
      <label for="questionText">Question Box</label><br /><br />     
    </form>
    <!-- Two viewports -->
    <div class="viewport">
        <!-- Content for the first viewport -->
        <h2>Viewport 1</h2>
        <div id="list"></div> <!-- Container for the cards -->
    </div>
    
    

    <script>
      let host = "http://localhost:8080";
    let questions = [];
    displayTheQuestions();

    async function getAll() {
        let response = await fetch(host + "/questions");
        let result = await response.json();
        return result;
    }

    async function displayTheQuestions() {
        if (questions.length == 0) {
            questions = await getAll();
        }

        for (let question of questions) {
            let list = document.createElement("div");
            list.className = "card";
            let innerHtml = `
                <img src="${host}/questions/${question.id}/image" alt="question" style="width:100%">
                <div class="container">
                    <h4><b>${question.id}</b></h4> 
                    <p>${question.description}</p>
                    <form>
                        <input type="radio" id="q${question.id}ptionA" name="q2Answer" value="A">
                        <label for="q${question.id}ptionA">${question.choices[0]}</label><br>

                        <input type="radio" id="q${question.id}ptionB" name="q2Answer" value="B">
                        <label for="q${question.id}ptionB">${question.choices[1]}</label><br>

                        <input type="radio" id="q${question.id}ptionC" name="q2Answer" value="C">
                        <label for="q${question.id}ptionC">${question.choices[2]}</label><br>       
                    </form> 
                </div>
            `;
            list.innerHTML = innerHtml;
            document.getElementById("list").appendChild(list);
        }
    }
      function add() {
        let form = document.forms[0];
        let formData = new FormData(form);
        // output as an object
        let data = Object.fromEntries(formData);
        let question = {};
        question.description = data.description;
        question.choices = [data.optionA, data.optionB, data.optionC];
        switch (data.answer) {
          case "A":
            question.answer = data.optionA;
            break;
          case "B":
            question.answer = data.optionB;
            break;
          case "C":
            question.answer = data.optionC;
            break;
        }        
        addTheQuestion(question, data.imageFile);
      }

      async function addTheQuestion(question, imageFile) {
        let message = "";

        let request = {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(question),
        };
        let response = await fetch(host + "/questions", request);
        if (response.status == 200) {
          let id = await response.json();
          let result = await submitTheImage(id, imageFile);
          if (result) {
            message = "The question was added successfully!";
          } else {
            message =
              "Something went wrong! Question data was saved successfully but question image was not saved.";
          }
        } else {
          console.log(response);
          message = "Something went wrong! Question data could not be saved.";
        }
        alert(message);
        location.href = "add-question.html";
      }

      async function submitTheImage(id, imageFile) {
        let formData = new FormData();
        formData.append("file", imageFile);
        let request = {
          method: "POST",
          body: formData,
        };
        let response = await fetch(
          host + "/questions/" + id + "/image",
          request
        );
        let result = await response.json();
        return result;
      }
    </script>
  </body>
</html>
